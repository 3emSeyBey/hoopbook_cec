const daysTag=document.querySelector(".days"),currentDate=document.querySelector(".current-date"),prevNextIcon=document.querySelectorAll(".icons span"),isFromUser=window.location.href.includes("user");var url=new URL(window.location.href),court_id=url.searchParams.get("court_id");url.pathname=url.pathname.substring(0,url.pathname.lastIndexOf("/"));var reservations=[],resDatesSched=[],dateClicked="",tableFiltered=!1,dateUnavailabilityArray=[];let date=new Date,currYear=date.getFullYear(),currMonth=date.getMonth();var completeRows=[];const months=["January","February","March","April","May","June","July","August","September","October","November","December"],renderCalendar=async()=>{resDatesSched=[],await getReservations(),reservations.forEach((function(reservation){var datetime_start=new Date(reservation.datetime_start),date=datetime_start.toISOString().split("T")[0];resDatesSched[date]||(resDatesSched[date]=0),resDatesSched[date]+=reservation.hours;var day=datetime_start.getDay();0===day||6===day?resDatesSched[date]>=12&&(dateUnavailabilityArray.includes(date)||dateUnavailabilityArray.push(date)):resDatesSched[date]>=5&&(dateUnavailabilityArray.includes(date)||dateUnavailabilityArray.push(date))}));let firstDayofMonth=new Date(currYear,currMonth,1).getDay(),lastDateofMonth=new Date(currYear,currMonth+1,0).getDate(),lastDayofMonth=new Date(currYear,currMonth,lastDateofMonth).getDay(),lastDateofLastMonth=new Date(currYear,currMonth,0).getDate(),liTag="";for(let i=firstDayofMonth;i>0;i--)liTag+=`<li class="calendar-date inactive">${lastDateofLastMonth-i+1}</li>`;for(let i=1;i<=lastDateofMonth;i++)dateUnavailabilityArray.includes(new Date(currYear,currMonth,i+1).toISOString().split("T")[0])?liTag+=`<li class="calendar-date unavailable">${i}</li>`:liTag+=`<li class="calendar-date available">${i}</li>`;for(let i=lastDayofMonth;i<6;i++)liTag+=`<li class="calendar-date inactive">${i-lastDayofMonth+1}</li>`;currentDate.innerText=`${months[currMonth]} ${currYear}`,daysTag.innerHTML=liTag,document.querySelectorAll(".calendar-date").forEach((function(dateElement){dateElement.addEventListener("click",(function(){if(!this.classList.contains("inactive")){document.querySelectorAll(".calendar-date").forEach((function(dateElement){dateElement.classList.remove("active")})),this.classList.add("active");var selectedDay=this.textContent,selectedDate,dateString=new Date(currYear,currMonth,selectedDay).toLocaleDateString();date=dateString;var formattedDate=formatDate();dateClicked=formattedDate,console.log(dateClicked),isFromUser?filterTableBySlots():filterTableByDate(formattedDate)}}))})),completeRows=document.querySelectorAll("#list tbody tr")};function formatDate(){var d=new Date(date),month=""+d.toLocaleString("en-US",{month:"short"}),day=""+d.getDate(),year=d.getFullYear();return day.length<2&&(day="0"+day),month+" "+day+", "+year}function filterTableByDate(formattedDae){for(var formattedDate=formattedDae,tbody=document.querySelector("#list tbody");tbody.firstChild;)tbody.removeChild(tbody.firstChild);completeRows.forEach((function(row){tbody.appendChild(row)}));var rows=Array.from(tbody.children),filteredRows=rows.filter((function(row){var courtName;return row.cells[2].innerText.trim().toLowerCase().includes(formattedDate.toLowerCase())}));rows.forEach((function(row){filteredRows.includes(row)||row.remove()}))}function fetchReservations(date){alert("asd");var xhr=new XMLHttpRequest;xhr.open("GET","calendar/index.php?fetch_reservations=true&date="+date,!0),xhr.onload=function(){200==this.status&&(document.querySelector("#test").innerHTML=date)},xhr.send()}async function filterTableBySlots(){let date=new Date(dateClicked),dayOfWeek=date.getDay(),table=document.getElementById("time-slot-table");if(dayOfWeek>=1&&dayOfWeek<=5){if(!tableFiltered){for(let i=1;i<8;i++)table.rows.length>i&&(table.rows[i].style.display="none");tableFiltered=!0}}else{for(let i=1;i<8;i++)table.rows.length>i&&(table.rows[i].style.display="");tableFiltered=!1}for(let i=0;i<table.rows.length;i++){let row=table.rows[i];row.style.color="black";let checkbox=row.querySelector('input[type="checkbox"]');checkbox&&(checkbox.disabled=!1);let cellContent=row.querySelector("td");cellContent&&(cellContent.style.color="black")}reservations.forEach(reservation=>{let reservationDate=new Date(reservation.datetime_start);if(reservationDate.toDateString()===date.toDateString()){let hour=reservationDate.getHours();for(let i=0;i<table.rows.length;i++){let row,cellContent;if(table.rows[i].cells[0].textContent.startsWith(hour.toString())){for(let j=0;j<reservation.hours;j++){table.rows[i+j].cells[0].style.color="red";let checkbox=table.rows[i+j].querySelector('input[type="checkbox"]');checkbox&&(checkbox.disabled=!0)}break}}}})}async function getReservations(){var ajaxOptions={url:window.location.origin+"/hoopbook/user/add/getReservations.php",type:"GET",success:function(response){reservations=JSON.parse(response)}};window.location.href.includes("user")&&(ajaxOptions.data={court_id:court_id}),await $.ajax(ajaxOptions)}prevNextIcon.forEach(icon=>{icon.addEventListener("click",()=>{alert("clicked"),currMonth="prev"===icon.id?currMonth-1:currMonth+1,currMonth<0||currMonth>11?(date=new Date(currYear,currMonth,(new Date).getDate()),currYear=date.getFullYear(),currMonth=date.getMonth()):date=new Date,renderCalendar()})});